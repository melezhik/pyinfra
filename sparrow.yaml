image:
  - melezhik/sparrow:alpine
  - melezhik/sparrow:debian
tasks:
  - 
    name: unit-tests
    default: true
    language: Bash
    code: |
      set -e
      cd source
      if test $os = "alpine"; then
        pytest --cov --disable-warnings
      elif test $os = "debian"; then
        pytest-3 --cov --disable-warnings
      fi      
    depends:
      -
        name: install-deps
  -
    name: install-deps
    language: Bash
    code: |
      set -e
      cd source
      pip3 install '.[test]'
    depends:
      -
        name: install-python
  -
    name: install-python
    language: Bash
    code: |
      if test $os = "alpine"; then
        sudo apk add py3-pip py3-pytest
      elif test $os = "debian"; then
        sudo apt-get install -y python3-pip python3-pytest
      fi
